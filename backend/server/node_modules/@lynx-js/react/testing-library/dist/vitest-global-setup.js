import * as __WEBPACK_EXTERNAL_MODULE_preact__ from "preact";
import * as __WEBPACK_EXTERNAL_MODULE__runtime_lib_snapshot_js_675dfde4__ from "../../runtime/lib/snapshot.js";
import * as __WEBPACK_EXTERNAL_MODULE__runtime_lib_backgroundSnapshot_js_d70e0888__ from "../../runtime/lib/backgroundSnapshot.js";
import * as __WEBPACK_EXTERNAL_MODULE__runtime_lib_lynx_calledByNative_js_f689039d__ from "../../runtime/lib/lynx/calledByNative.js";
import * as __WEBPACK_EXTERNAL_MODULE__runtime_lib_lifecycle_patch_updateMainThread_js_dca3a751__ from "../../runtime/lib/lifecycle/patch/updateMainThread.js";
import * as __WEBPACK_EXTERNAL_MODULE__runtime_lib_lifecycle_patch_commit_js_9adc7328__ from "../../runtime/lib/lifecycle/patch/commit.js";
import * as __WEBPACK_EXTERNAL_MODULE__runtime_lib_lynx_tt_js_37d9bcb1__ from "../../runtime/lib/lynx/tt.js";
import * as __WEBPACK_EXTERNAL_MODULE__runtime_lib_root_js_27522aef__ from "../../runtime/lib/root.js";
import * as __WEBPACK_EXTERNAL_MODULE__runtime_lib_lifecycle_patch_snapshotPatch_js_c1ebb33c__ from "../../runtime/lib/lifecycle/patch/snapshotPatch.js";
import * as __WEBPACK_EXTERNAL_MODULE__worklet_runtime_lib_api_lynxApi_js_c6dc2d67__ from "../../worklet-runtime/lib/api/lynxApi.js";
import * as __WEBPACK_EXTERNAL_MODULE__worklet_runtime_lib_listeners_js_9f7cd330__ from "../../worklet-runtime/lib/listeners.js";
import * as __WEBPACK_EXTERNAL_MODULE__worklet_runtime_lib_workletRuntime_js_e9debbe1__ from "../../worklet-runtime/lib/workletRuntime.js";
import * as __WEBPACK_EXTERNAL_MODULE__runtime_lib_worklet_destroy_js_8a273fd1__ from "../../runtime/lib/worklet/destroy.js";
const { onInjectMainThreadGlobals, onInjectBackgroundThreadGlobals, onResetLynxEnv, onSwitchedToMainThread, onSwitchedToBackgroundThread, onInitWorkletRuntime } = globalThis;
(0, __WEBPACK_EXTERNAL_MODULE__runtime_lib_lynx_calledByNative_js_f689039d__.injectCalledByNative)();
(0, __WEBPACK_EXTERNAL_MODULE__runtime_lib_lifecycle_patch_updateMainThread_js_dca3a751__.injectUpdateMainThread)();
(0, __WEBPACK_EXTERNAL_MODULE__runtime_lib_lifecycle_patch_commit_js_9adc7328__.replaceCommitHook)();
globalThis.onInitWorkletRuntime = ()=>{
    if (onInitWorkletRuntime) onInitWorkletRuntime();
    if (process.env.DEBUG) console.log('initWorkletRuntime');
    lynx.setTimeout = setTimeout;
    lynx.setInterval = setInterval;
    lynx.clearTimeout = clearTimeout;
    lynx.clearInterval = clearInterval;
    (0, __WEBPACK_EXTERNAL_MODULE__worklet_runtime_lib_workletRuntime_js_e9debbe1__.initWorklet)();
    (0, __WEBPACK_EXTERNAL_MODULE__worklet_runtime_lib_api_lynxApi_js_c6dc2d67__.initApiEnv)();
    (0, __WEBPACK_EXTERNAL_MODULE__worklet_runtime_lib_listeners_js_9f7cd330__.initEventListeners)();
    return true;
};
globalThis.onInjectMainThreadGlobals = (target)=>{
    if (onInjectMainThreadGlobals) onInjectMainThreadGlobals();
    if (process.env.DEBUG) console.log('onInjectMainThreadGlobals');
    __WEBPACK_EXTERNAL_MODULE__runtime_lib_snapshot_js_675dfde4__.snapshotInstanceManager.clear();
    __WEBPACK_EXTERNAL_MODULE__runtime_lib_snapshot_js_675dfde4__.snapshotInstanceManager.nextId = 0;
    target.__root = new __WEBPACK_EXTERNAL_MODULE__runtime_lib_snapshot_js_675dfde4__.SnapshotInstance('root');
    function setupDocument(document) {
        document.createElement = function(type) {
            return new __WEBPACK_EXTERNAL_MODULE__runtime_lib_snapshot_js_675dfde4__.SnapshotInstance(type);
        };
        document.createElementNS = function(_ns, type) {
            return new __WEBPACK_EXTERNAL_MODULE__runtime_lib_snapshot_js_675dfde4__.SnapshotInstance(type);
        };
        document.createTextNode = function(text) {
            const i = new __WEBPACK_EXTERNAL_MODULE__runtime_lib_snapshot_js_675dfde4__.SnapshotInstance(null);
            i.setAttribute(0, text);
            Object.defineProperty(i, 'data', {
                set (v) {
                    i.setAttribute(0, v);
                }
            });
            return i;
        };
        return document;
    }
    target._document = setupDocument({});
    target.globalPipelineOptions = void 0;
};
globalThis.onInjectBackgroundThreadGlobals = (target)=>{
    if (onInjectBackgroundThreadGlobals) onInjectBackgroundThreadGlobals();
    if (process.env.DEBUG) console.log('onInjectBackgroundThreadGlobals');
    __WEBPACK_EXTERNAL_MODULE__runtime_lib_snapshot_js_675dfde4__.backgroundSnapshotInstanceManager.clear();
    __WEBPACK_EXTERNAL_MODULE__runtime_lib_snapshot_js_675dfde4__.backgroundSnapshotInstanceManager.nextId = 0;
    target.__root = new __WEBPACK_EXTERNAL_MODULE__runtime_lib_backgroundSnapshot_js_d70e0888__.BackgroundSnapshotInstance('root');
    function setupBackgroundDocument(document) {
        document.createElement = function(type) {
            return new __WEBPACK_EXTERNAL_MODULE__runtime_lib_backgroundSnapshot_js_d70e0888__.BackgroundSnapshotInstance(type);
        };
        document.createElementNS = function(_ns, type) {
            return new __WEBPACK_EXTERNAL_MODULE__runtime_lib_backgroundSnapshot_js_d70e0888__.BackgroundSnapshotInstance(type);
        };
        document.createTextNode = function(text) {
            const i = new __WEBPACK_EXTERNAL_MODULE__runtime_lib_backgroundSnapshot_js_d70e0888__.BackgroundSnapshotInstance(null);
            i.setAttribute(0, text);
            Object.defineProperty(i, 'data', {
                set (v) {
                    i.setAttribute(0, v);
                }
            });
            return i;
        };
        return document;
    }
    target._document = setupBackgroundDocument({});
    target.globalPipelineOptions = void 0;
    const oldLynxCoreInject = globalThis.lynxCoreInject;
    globalThis.lynxCoreInject = target.lynxCoreInject;
    (0, __WEBPACK_EXTERNAL_MODULE__runtime_lib_lynx_tt_js_37d9bcb1__.injectTt)();
    globalThis.lynxCoreInject = oldLynxCoreInject;
    (0, __WEBPACK_EXTERNAL_MODULE__runtime_lib_lifecycle_patch_snapshotPatch_js_c1ebb33c__.deinitGlobalSnapshotPatch)();
    (0, __WEBPACK_EXTERNAL_MODULE__runtime_lib_lifecycle_patch_commit_js_9adc7328__.clearPatchesToCommit)();
    (0, __WEBPACK_EXTERNAL_MODULE__runtime_lib_lifecycle_patch_commit_js_9adc7328__.clearCommitTaskId)();
};
globalThis.onResetLynxEnv = ()=>{
    if (onResetLynxEnv) onResetLynxEnv();
    if (process.env.DEBUG) console.log('onResetLynxEnv');
    (0, __WEBPACK_EXTERNAL_MODULE__runtime_lib_lynx_tt_js_37d9bcb1__.flushDelayedLifecycleEvents)();
    (0, __WEBPACK_EXTERNAL_MODULE__runtime_lib_worklet_destroy_js_8a273fd1__.destroyWorklet)();
    lynxEnv.switchToMainThread();
    (0, __WEBPACK_EXTERNAL_MODULE__worklet_runtime_lib_listeners_js_9f7cd330__.initEventListeners)();
    lynxEnv.switchToBackgroundThread();
};
globalThis.onSwitchedToMainThread = ()=>{
    if (onSwitchedToMainThread) onSwitchedToMainThread();
    if (process.env.DEBUG) console.log('onSwitchedToMainThread');
    (0, __WEBPACK_EXTERNAL_MODULE__runtime_lib_root_js_27522aef__.setRoot)(globalThis.__root);
    __WEBPACK_EXTERNAL_MODULE_preact__.options.document = globalThis._document;
};
globalThis.onSwitchedToBackgroundThread = ()=>{
    if (onSwitchedToBackgroundThread) onSwitchedToBackgroundThread();
    if (process.env.DEBUG) console.log('onSwitchedToBackgroundThread');
    (0, __WEBPACK_EXTERNAL_MODULE__runtime_lib_root_js_27522aef__.setRoot)(globalThis.__root);
    __WEBPACK_EXTERNAL_MODULE_preact__.options.document = globalThis._document;
};
globalThis.onInjectMainThreadGlobals(globalThis.lynxEnv.mainThread.globalThis);
globalThis.onInjectBackgroundThreadGlobals(globalThis.lynxEnv.backgroundThread.globalThis);
